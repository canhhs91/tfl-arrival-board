<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <title>TFL Arrivals</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        function updateUI() {
            $.get("/get_arrivals", function(data) {
                // Update the UI with the received data
                // For example, you can update a <div> element with id "arrivals" with the data
                const arrivalsContainer = document.getElementById("arrivals");
                arrivalsContainer.innerHTML = ''; // Clear previous data
                const arrivalsTitle = document.createElement("div");
                arrivalsTitle.classList.add("arrivals-title", "text--heavy");

                // Get the current time
                const now = new Date();

                // Format the time as "h:mm a"
                const hours = now.getHours();
                const minutes = now.getMinutes();
                const ampm = hours >= 12 ? "PM" : "AM";
                const formattedHours = hours % 12 || 12;
                const formattedMinutes = minutes.toString().padStart(2, '0');
                const currentTime = `${formattedHours}:${formattedMinutes} ${ampm}`;

                // Set the text content of arrivalsTitle to include the current time
                arrivalsTitle.textContent = `Sullivan Avenue Stop K - ${currentTime}`;

                arrivalsContainer.appendChild(arrivalsTitle);

                data.arrivals.slice(0, 7).forEach(function(arrival, index) {
                    const arrivalItem = document.createElement("div");
                    arrivalItem.classList.add("arrival-item");
                    // Create separate divs for lineName, destination, and timeToStation
                    const orderDiv = document.createElement("div");
                    orderDiv.classList.add("order");
                    orderDiv.textContent = index + 1;

                    // Create separate divs for lineName, destination, and timeToStation
                    const lineNameDiv = document.createElement("div");
                    lineNameDiv.classList.add("line-name");
                    lineNameDiv.textContent = arrival.lineName;

                    const destinationDiv = document.createElement("div");
                    destinationDiv.classList.add("destination");
                    destinationDiv.innerHTML = "<div class='destination-text'>" + arrival.destinationName + "</div>";

                    const timeToStationDiv = document.createElement("div");
                    timeToStationDiv.textContent = `${arrival.timeToStationMins}`;

                    // Append the divs to the arrivalItem
                    arrivalItem.appendChild(orderDiv);
                    arrivalItem.appendChild(lineNameDiv);
                    arrivalItem.appendChild(destinationDiv);
                    arrivalItem.appendChild(timeToStationDiv);

                    arrivalsContainer.appendChild(arrivalItem);
                });

                

            });
        }

        // Periodically update the UI every 15 seconds
        setInterval(updateUI, 15000);
        
        // Initialize the UI on page load
        updateUI();
    </script>

</head>
<body>
    <div class="led-matrix">
        <div class="text text-regular">
            <!-- Add a <div> element to display the arrivals -->
            
                <div id="arrivals" class="timetable-container">
                </div>
        </div>
    </div>
</body>
</html>
